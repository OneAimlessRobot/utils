BINARY= emotionserver.exe

SERVERBIN= ./server/server.exe

CLIENTBIN= ./client/client.exe

BROWSERBIN= ./server_browser/server_browser.exe

HEARTBEATBIN= ./heartbeat/heart_beat.exe

MASTERBIN= ./master_server/master_server.exe

PORT_MAPPER_BIN= ./port_mapper/port_mapper.exe

CONVERTER_TOOL_BIN= ./converter_tool/converter_tool.exe

LDLIBS :=  -lm

LD_LOCAL_STATIC_LIBS_FOLDER= -L./libs

LDLIBS_SOUND_PLUGINS :=  -lalsa -loss

LDLIBS_SOUND := -lpulse -lao -lpulse-simple -lasound $(LD_LOCAL_STATIC_LIBS_FOLDER) -lmpg123

TSAN_FLAGS = -fsanitize=thread -O0 -g -fno-omit-frame-pointer

LDLIBS_PTHREAD= -lpthread

LDLIBS_SSL_AND_CRYPTO= $(LD_LOCAL_STATIC_LIBS_FOLDER)  -lssl -lcrypto

LDLIBS_SQLITE= -lm  $(LD_LOCAL_STATIC_LIBS_FOLDER)  -lsqlite3

LDLIBS_CLIENT += $(LDLIBS_PTHREAD) $(LDLIBS_SSL_AND_CRYPTO) $(LDLIBS_SOUND) -lpthread  $(LD_LOCAL_STATIC_LIBS_FOLDER)  -lncurses

LDLIBS_SERVER += $(LDLIBS_PTHREAD) $(LDLIBS_SSL_AND_CRYPTO)

INCLUDE= ./Includes ./openssl/includes ./mpg123-1.32.10/src/include ./sqlite-amalgamation-3510000 ./wav_stuff_i_stole_because_i_am_lazy .
SOURCES= . ./Sources

SERVERINCLUDE= ./server/Includes ./extra_funcs/Includes
SERVERSOURCES= ./server/Sources ./server ./extra_funcs/Sources
SERVERRESOURCES= ./server/resources

CLIENTINCLUDE= ./client/Includes ./extra_funcs/Includes
CLIENTSOURCES= ./client/Sources ./client ./extra_funcs/Sources ./wav_stuff_i_stole_because_i_am_lazy
CLIENTRESOURCES= ./client/resources

BROWSERINCLUDE= ./server_browser/Includes ./extra_funcs/Includes
BROWSERSOURCES= ./server_browser/Sources ./server_browser ./extra_funcs/Sources
BROWSERRESOURCES= ./server_browser/resources

HEARTBEATINCLUDE= ./heartbeat/Includes ./extra_funcs/Includes
HEARTBEATSOURCES= ./heartbeat/Sources ./heartbeat ./extra_funcs/Sources
HEARTBEATRESOURCES= ./heartbeat/resources

MASTERINCLUDE= ./master_server/Includes ./extra_funcs/Includes
MASTERSOURCES= ./master_server/Sources ./master_server ./extra_funcs/Sources
MASTERRESOURCES= ./master_server/resources

PORT_MAPPER_INCLUDE= ./port_mapper/Includes ./extra_funcs/Includes
PORT_MAPPER_SOURCES= ./port_mapper/Sources ./port_mapper ./extra_funcs/Sources
PORT_MAPPER_RESOURCES= ./port_mapper/resources


CONVERTER_TOOL_INCLUDE= ./converter_tool/Includes ./extra_funcs/Includes
CONVERTER_TOOL_SOURCES= ./converter_tool/Sources ./converter_tool ./extra_funcs/Sources
CONVERTER_TOOL_EXTRA_SOURCES= ./converter_tool/Sources ./extra_funcs/Sources
CONVERTER_TOOL_RESOURCES= ./converter_tool/resources


RESDIR= ./resources

CURRDIR=`pwd`

CC= cc
#CC= gcc
#CC=clang
DEPFLAGS= -MP -MD

#CFLAGS += -fsanitize=thread -Wall -DPROGRAMPATHAUX="$(CURRDIR)"  -Wextra -g $(foreach D, $(INCLUDE), -I$(D)) $(DEPFLAGS)
#CFLAGS += -fsanitize=address -Wall -DPROGRAMPATHAUX="$(CURRDIR)"  -Wextra -g $(foreach D, $(INCLUDE), -I$(D)) $(DEPFLAGS)
CFLAGS += -Wall -DPROGRAMPATHAUX="$(CURRDIR)/"  -Wextra -g $(foreach D, $(INCLUDE), -I$(D)) $(DEPFLAGS)

CFLAGS2 :=  $(CFLAGS) $(SDL_CFLAGS) -O0


SOURCEFILES=$(foreach D,$(SOURCES), $(wildcard $(D)/*.c))

CLIENTSOURCEFILES=$(foreach D,$(CLIENTSOURCES), $(wildcard $(D)/*.c))

SERVERSOURCEFILES=$(foreach D,$(SERVERSOURCES), $(wildcard $(D)/*.c))

HEARTBEATSOURCEFILES=$(foreach D,$(HEARTBEATSOURCES), $(wildcard $(D)/*.c))

BROWSERSOURCEFILES=$(foreach D,$(BROWSERSOURCES), $(wildcard $(D)/*.c))

MASTERSOURCEFILES=$(foreach D,$(MASTERSOURCES), $(wildcard $(D)/*.c))

PORT_MAPPER_SOURCEFILES=$(foreach D,$(PORT_MAPPER_SOURCES), $(wildcard $(D)/*.c))

CONVERTER_TOOL_SOURCEFILES=$(foreach D,$(CONVERTER_TOOL_SOURCES), $(wildcard $(D)/*.c))

CONVERTER_TOOL_EXTRA_SOURCEFILES=$(foreach D,$(CONVERTER_TOOL_EXTRA_SOURCES), $(wildcard $(D)/*.c))



RESOURCEFILES=$(wildcard $(RESDIR)/*.o)

SERVERRESOURCEFILES=$(wildcard $(SERVERRESOURCES)/*.o)

CLIENTRESOURCEFILES=$(wildcard $(CLIENTRESOURCES)/*.o)

BROWSERRESOURCEFILES=$(wildcard $(BROWSERRESOURCES)/*.o)

HEARTBEATRESOURCEFILES=$(wildcard $(HEARTBEATRESOURCES)/*.o)

MASTERRESOURCEFILES=$(wildcard $(MASTERRESOURCES)/*.o)

PORT_MAPPER_RESOURCEFILES=$(wildcard $(PORT_MAPPER_RESOURCES)/*.o)

CONVERTER_TOOL_RESOURCEFILES=$(wildcard $(CONVERTER_TOOL_RESOURCES)/*.o)


OBJECTS=$(patsubst %.c,%.o,$(SOURCEFILES))

CLIENTOBJECTS=$(patsubst %.c,%.o,$(CLIENTSOURCEFILES))

SERVEROBJECTS=$(patsubst %.c,%.o,$(SERVERSOURCEFILES))

BROWSEROBJECTS=$(patsubst %.c,%.o,$(BROWSERSOURCEFILES))

HEARTBEATOBJECTS=$(patsubst %.c,%.o,$(HEARTBEATSOURCEFILES))

MASTEROBJECTS=$(patsubst %.c,%.o,$(MASTERSOURCEFILES))

PORT_MAPPER_OBJECTS=$(patsubst %.c,%.o,$(PORT_MAPPER_SOURCEFILES))

CONVERTER_TOOL_OBJECTS=$(patsubst %.c,%.o,$(CONVERTER_TOOL_SOURCEFILES))

CONVERTER_TOOL_EXTRA_OBJECTS=$(patsubst %.c,%.o,$(CONVERTER_TOOL_EXTRA_SOURCEFILES))


ALLMODULES= $(RESOURCEFILES) $(OBJECTS) $(SERVEROBJECTS)  $(CLIENTOBJECTS) $(SERVERRESOURCEFILES) $(CLIENTRESOURCEFILES) $(HEARTBEATRESOURCES) $(HEARTBEATOBJECTS) $(BROWSERRESOURCES) $(BROWSEROBJECTS) $(MASTERRESOURCES) $(MASTEROBJECTS) $(PORT_MAPPER_RESOURCES) $(PORT_MAPPER_OBJECTS) $(CONVERTER_TOOL_RESOURCES) $(CONVERTER_TOOL_OBJECTS)

SERVERMODULES= $(SERVEROBJECTS)  $(SERVERRESOURCEFILES)

CLIENTMODULES= $(CLIENTOBJECTS) $(CLIENTRESOURCEFILES)

HEARTBEATMODULES= $(HEARTBEATOBJECTS) $(HEARTBEATRESOURCEFILES)

BROWSERMODULES= $(BROWSEROBJECTS) $(BROWSERRESOURCEFILES)

MASTERMODULES= $(MASTEROBJECTS) $(MASTERRESOURCEFILES)

PORT_MAPPER_MODULES= $(PORT_MAPPER_OBJECTS) $(PORT_MAPPER_RESOURCEFILES)

CONVERTER_TOOL_MODULES= $(CONVERTER_TOOL_OBJECTS) $(CONVERTER_TOOL_RESOURCEFILES)


DEPFILES= $(patsubst %.c,%.d,$(SOURCEFILES)) $(SERVERDEPFILES) $(CLIENTDEPFILES) $(MASTERDEPFILES) $(PORT_MAPPER_DEPFILES) $(CONVERTER_TOOL_DEPFILES)


SERVERDEPFILES= $(patsubst %.c,%.d,$(SERVERSOURCEFILES))

CLIENTDEPFILES= $(patsubst %.c,%.d,$(CLIENTSOURCEFILES))

HEARTBEATDEPFILES= $(patsubst %.c,%.d,$(HEARTBEATSOURCEFILES))

BROWSERDEPFILES= $(patsubst %.c,%.d,$(BROWSERSOURCEFILES))

MASTERDEPFILES= $(patsubst %.c,%.d,$(MASTERSOURCEFILES))

PORT_MAPPER_DEPFILES= $(patsubst %.c,%.d,$(PORT_MAPPER_SOURCEFILES))

CONVERTER_TOOL_DEPFILES= $(patsubst %.c,%.d,$(CONVERTER_TOOL_SOURCEFILES))



CLIENTSTUFF=  $(CLIENTOBJECTS)

SERVERSTUFF= $(SERVEROBJECTS)

BROWSERSTUFF= $(BROWSEROBJECTS)

HEARTBEATSTUFF= $(HEARTBEATOBJECTS)

MASTERSTUFF= $(MASTEROBJECTS)

PORT_MAPPER_STUFF= $(PORT_MAPPER_OBJECTS)

CONVERTER_TOOL_STUFF= $(CONVERTER_TOOL_OBJECTS)

CONVERTER_TOOL_EXTRA_STUFF= $(CONVERTER_TOOL_EXTRA_OBJECTS)

client: $(CLIENTBIN)

server: $(SERVERBIN)

browser: $(HEARTBEATBIN)

heartbeat: $(BROWSERBIN)

master: $(MASTERBIN)

port_mapper: $(PORT_MAPPER_BIN)

converter_tool: $(CONVERTER_TOOL_BIN)

main: $(BINARY)


$(BINARY): $(OBJECTS)
	$(CC) -g -v  $(CFLAGS) -o  $@ $^

$(SERVERBIN): $(SERVERSTUFF) $(CONVERTER_TOOL_EXTRA_STUFF)
	$(CC) -g -v  $(CFLAGS) -o  $@ $^ $(SERVERRESOURCEFILES)   $(LDLIBS) $(LDLIBS_SERVER) $(LDLIBS_SQLITE)

$(CLIENTBIN): $(CLIENTSTUFF) $(CONVERTER_TOOL_EXTRA_STUFF)
	$(CC) -g -v  $(CFLAGS) -o  $@ $^ $(CLIENTRESOURCEFILES) $(LDLIBS_CLIENT) $(LDLIBS) $(LDLIBS_SQLITE)

$(BROWSERBIN): $(BROWSERSTUFF)
	$(CC) -g -v  $(CFLAGS) -o  $@ $^ $(BROWSERRESOURCEFILES) $(LDLIBS) $(LDLIBS_SERVER) $(LDLIBS_SQLITE)

$(HEARTBEATBIN): $(HEARTBEATSTUFF)
	$(CC) -g -v  $(CFLAGS) -o  $@ $^ $(HEARTBEATRESOURCEFILES) $(LDLIBS) $(LDLIBS_SERVER) $(LDLIBS_SQLITE)

$(MASTERBIN): $(MASTERSTUFF)
	$(CC) -g -v  $(CFLAGS) -o  $@ $^ $(MASTERRESOURCEFILES) $(LDLIBS) $(LDLIBS_SERVER) $(LDLIBS_SQLITE)

$(PORT_MAPPER_BIN): $(PORT_MAPPER_STUFF)
	$(CC) -g -v  $(CFLAGS) -o  $@ $^ $(PORT_MAPPER_RESOURCEFILES) $(LDLIBS_SSL_AND_CRYPTO) $(LDLIBS) $(LDLIBS_SQLITE)

$(CONVERTER_TOOL_BIN): $(CONVERTER_TOOL_STUFF)
	$(CC) -g -v  $(CFLAGS) -o  $@ $^ $(CONVERTER_TOOL_RESOURCEFILES)  $(LDLIBS_SSL_AND_CRYPTO) $(LDLIBS) $(LDLIBS_SQLITE)





%.o:%.c
	$(CC) -g  $(CFLAGS) -c -o $@ $<
	echo $(CFLAGS)

cleanall:
	rm -rf $(BINARY) $(SERVERBIN) $(CLIENTBIN) $(PORT_MAPPER_BIN) $(HEARTBEATBIN) $(ALLMODULES) $(DEPFILES) $(BROWSERBIN) $(MASTERBIN) $(CONVERTER_TOOL_BIN)


cleanserver:
	rm -rf $(SERVERBIN) $(SERVERMODULES) $(DEPFILES) $(SERVERDEPFILES)


cleanclient:
	rm -rf $(CLIENTBIN) $(CLIENTMODULES) $(DEPFILES) $(CLIENTDEPFILES)


cleanbrowser:
	rm -rf $(BROWSERBIN) $(BROWSERMODULES) $(DEPFILES) $(BROWSERDEPFILES)

cleanheartbeat:
	rm -rf$(HEARTBEATBIN) $(HEARTBEATMODULES) $(DEPFILES) $(HEARTBEATDEPFILES)

cleanmaster:
	rm -rf$(MASTERBIN) $(MASTERMODULES) $(DEPFILES) $(MASTERDEPFILES)

clean_port_mapper:
	rm -rf$(PORT_MAPPER_BIN) $(PORT_MAPPER_MODULES) $(DEPFILES) $(PORT_MAPPER_DEPFILES)

clean_converter_tool:
	rm -rf$(CONVERTER_TOOL_BIN) $(CONVERTER_TOOL_MODULES) $(DEPFILES) $(CONVERTER_TOOL_DEPFILES)



